{% extends "layout.html" %}

{% block content %}

{% if mode == "list" %}
  <h4 class="fw-bold mb-3">Elections</h4>

  <div class="row g-3">
    {% for e in elections %}
      <div class="col-md-6 col-lg-4">
        <div class="card rounded-4 shadow-sm h-100">
          <div class="card-body">
            <h5 class="fw-bold mb-1">{{ e.title }}</h5>
            <div class="small text-muted">Start (UTC): {{ e.start_at }}</div>
            <div class="small text-muted">End (UTC): {{ e.end_at }}</div>
          </div>
          <div class="card-footer bg-white border-0 pb-3">
            <a class="btn btn-dark w-100" href="/vote/{{ e.id }}">Vote</a>
          </div>
        </div>
      </div>
    {% else %}
      <p class="text-muted">No elections available.</p>
    {% endfor %}
  </div>

{% elif mode == "register_face" %}
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="card rounded-4 shadow-sm">
        <div class="card-body p-4">
          <h4 class="fw-bold">Capture Face (Registration)</h4>
          <p class="text-muted">Keep your face centered and ensure good lighting.</p>

          <div class="camera-wrap">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" class="d-none"></canvas>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button type="button" class="btn btn-outline-dark" onclick="startCamera()">Start Camera</button>
            <button type="button" class="btn btn-primary" onclick="captureAndRegister()">Capture & Register</button>
          </div>

          <div id="status" class="mt-3 small text-muted"></div>
        </div>
      </div>
    </div>
  </div>

{% elif mode == "login_face" %}
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="card rounded-4 shadow-sm">
        <div class="card-body p-4">
          <h4 class="fw-bold">Face Verification (Login)</h4>
          <p class="text-muted">Verify your face to login.</p>

          <div class="camera-wrap">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" class="d-none"></canvas>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button type="button" class="btn btn-outline-dark" onclick="startCamera()">Start Camera</button>
            <button type="button" class="btn btn-primary" onclick="captureAndLogin()">Capture & Login</button>
          </div>

          <div id="status" class="mt-3 small text-muted"></div>
        </div>
      </div>
    </div>
  </div>

{% elif mode == "vote_face" %}
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="card rounded-4 shadow-sm">
        <div class="card-body p-4">
          <h4 class="fw-bold">Face Verification (Voting)</h4>
          <p class="text-muted">Verify your face to unlock vote submission.</p>

          <div class="camera-wrap">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" class="d-none"></canvas>
          </div>

          <div class="d-flex gap-2 mt-3">
            <button type="button" class="btn btn-outline-dark" onclick="startCamera()">Start Camera</button>
            <button type="button" class="btn btn-primary" onclick="captureAndVerifyVote()">Capture & Verify</button>
          </div>

          <div id="status" class="mt-3 small text-muted"></div>

          <div class="mt-3">
            <a class="btn btn-dark w-100" href="/vote/{{ election_id }}">Continue to Voting Page</a>
          </div>
        </div>
      </div>
    </div>
  </div>

{% else %}
  <div class="alert alert-warning rounded-4 shadow-sm">
    Invalid view mode. Please go back.
  </div>
{% endif %}

{% endblock %}